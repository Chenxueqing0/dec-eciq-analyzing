<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>主界面</title>
    <meta name="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.6/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="css/main.css"/>
    <script type="text/javascript" src="js/axios.min.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/public.js"></script>
</head>
<body>
<div id="main">
    <el-container direction="vertical" style="height: 100%">
        <el-header>
            <iframe align="center" width="100%" height="60" src="header.html" frameborder="no" border="0"
                    marginwidth="0" marginheight="0" scrolling="no"></iframe>
        </el-header>
        <el-container style="height: 100%">
            <el-aside width="220px">
                <el-row>
                    <el-col :span="12" style="width: 100%">
                        <el-menu
                                class="el-menu-vertical-demo"
                                background-color="#4E5467"
                                text-color="#fff" default-active="1-1">
                            <el-menu-item :hidden="roleLevel != '0'" index="1-1" @click="addTab('1-1','账号管理','accountId','account.html')"><i
                                    class="el-icon-menu" ></i>账号管理
                            </el-menu-item>
                            <el-menu-item :hidden="roleLevel != '0'" index="1-2" @click="addTab('1-2','版本管理','versionId','version.html')"><i
                                    class="el-icon-menu"></i>版本管理
                            </el-menu-item>
                            <el-menu-item  index="1-3" @click="addTab('1-3','申请记录','applyId','apply.html')"><i
                                    class="el-icon-menu"></i>申请记录
                            </el-menu-item>
                            <el-menu-item  index="1-4" @click="addTab('1-4','授权记录','authId','auth.html')"><i
                                    class="el-icon-menu"></i>授权记录
                            </el-menu-item>
                            <el-menu-item  index="1-5" @click="addTab('1-5','报检单','eciqId','eciq.html')"><i
                                    class="el-icon-menu"></i>报检单
                            </el-menu-item>
                            <el-menu-item  index="1-6" @click="addTab('1-6','报关单','dxpId','dxp.html')"><i
                                    class="el-icon-menu"></i>报关单
                            </el-menu-item>
                        </el-menu>
                    </el-col>
                </el-row>
            </el-aside>
            <el-main>
                <el-tabs v-model="editableTabsValue" type="card" @tab-remove="removeTab" style="height: 97%">
                    <el-tab-pane
                            v-for="(item, index) in editableTabs"
                            :key="item.name"
                            :label="item.title"
                            :name="item.name"
                            :closable="item.close"
                            style="height: 100%">
                        <iframe :id="item.iframeId" align="center" width="100%" height="99%" :src="item.html" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="auto"></iframe>
                        <!--                        <iframe :id="item.iframeId" style="height: 100%;width: 100%" :src="item.html" frameborder="0" scrolling="auto"></iframe>-->
                    </el-tab-pane>
                </el-tabs>
            </el-main>
        </el-container>
    </el-container>
</div>
</body>
<script type="text/javascript" src="js/vue/vue.js"></script>
<script src="https://unpkg.com/element-ui@2.15.6/lib/index.js"></script>
<script type="text/javascript" src="js/jquery/jquery.min.js"></script>
<script type="text/javascript" src="js/public.js"></script>
<script type="text/javascript">

    var main = new Vue({
        el: '#main',
        data: {
            editableTabsValue: '1',
            editableTabs: [],
            roleLevel:''
        },
        created() {
            this.init();
            // this.addTab('1-1', '账号管理', 'accountId', 'account.html');
        },
        methods: {
            init: function () {
                this.roleLevel='[[${session.pLevel}]]';
            },
            removeTab: function (targetName) {
                let tabs = this.editableTabs;
                let activeName = this.editableTabsValue;
                if (activeName === targetName) {
                    tabs.forEach(function (tab, index) {
                        if (tab.name === targetName) {
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            }
                        }
                    });
                }

                this.editableTabsValue = activeName;
                this.editableTabs = tabs.filter(tab => tab.name !== targetName);
            },
            addTab: function (targetName, title, iframeId, html) {
                // 判断该菜单是否已经打开
                var exist = false;
                for (var i = 0; i < this.editableTabs.length; i++) {
                    if (targetName == this.editableTabs[i].name) {
                        exist = true;
                        break;
                    }
                }

                // 如果打开，直接跳到该页面
                if (exist == true) {
                    this.editableTabsValue = targetName;
                    return;
                }

                // 新页面，新增一个tabs
                this.editableTabs.push({
                    title: title,
                    name: targetName,
                    close: 'closable',
                    html: html,
                    iframeId: iframeId
                });
                this.editableTabsValue = targetName;
            }
        }
    })
</script>
</html>
